> db.users.aggregate([{$match: {"visits" : {$gt: 300}}}])
{ "_id" : "vjaniya@example.ru", "first_name" : "Vinnie", "last_name" : "Janiya", "registration_date" : ISODate("2021-09-11T00:00:00Z"), "birth_date" : ISODate("1909-04-06T00:00:00Z"), "visits" : 645, "top_tags" : { "was" : 9, "as" : 1, "alice" : 8, "on" : 1, "own" : 8, "a" : 9 }, "karma" : -43 }
{ "_id" : "lluc@example.info", "first_name" : "Leny", "last_name" : "Luc", "registration_date" : ISODate("2021-03-11T00:00:00Z"), "birth_date" : ISODate("1995-09-05T00:00:00Z"), "visits" : 495, "top_tags" : { "a" : 3, "her" : 9, "book" : 3 }, "karma" : -33 }
{ "_id" : "byuko@example.com", "first_name" : "Babita", "last_name" : "Yuko", "registration_date" : ISODate("2020-01-15T00:00:00Z"), "birth_date" : ISODate("1956-10-25T00:00:00Z"), "visits" : 826, "top_tags" : { "sleepy" : 5, "there" : 8, "stupid" : 8 }, "karma" : 126 }
{ "_id" : "mmickey@example.info", "first_name" : "Mamie", "last_name" : "Mickey", "registration_date" : ISODate("2020-01-12T00:00:00Z"), "birth_date" : ISODate("1960-07-11T00:00:00Z"), "visits" : 805, "top_tags" : { "a" : 5, "book" : 5, "trouble" : 8 }, "karma" : 80 }
{ "_id" : "danni@example.com", "first_name" : "Deandra", "last_name" : "Anni", "registration_date" : ISODate("2020-01-27T00:00:00Z"), "birth_date" : ISODate("1975-01-28T00:00:00Z"), "visits" : 541, "top_tags" : { "to" : 9, "of" : 3, "watch" : 10, "rabbit" : 10, "use" : 4, "by" : 10 }, "karma" : -25 }
{ "_id" : "pcierra@example.ru", "first_name" : "Petrina", "last_name" : "Cierra", "registration_date" : ISODate("2020-02-16T00:00:00Z"), "birth_date" : ISODate("1986-08-11T00:00:00Z"), "visits" : 467, "top_tags" : { "actually" : 2, "the" : 6, "her" : 7, "watch" : 9, "getting" : 4, "when" : 6 }, "karma" : -7 }
{ "_id" : "gshena@example.net", "first_name" : "Gemma", "last_name" : "Shena", "registration_date" : ISODate("2020-10-06T00:00:00Z"), "birth_date" : ISODate("1907-07-10T00:00:00Z"), "visits" : 602, "top_tags" : { "seemed" : 5, "and" : 8, "twice" : 5, "her" : 5, "actually" : 7 }, "karma" : 160 }
{ "_id" : "ljoly@example.ru", "first_name" : "Lydia", "last_name" : "Joly", "registration_date" : ISODate("2021-10-18T00:00:00Z"), "birth_date" : ISODate("1957-05-06T00:00:00Z"), "visits" : 831, "top_tags" : { "in" : 4, "twice" : 6, "trouble" : 8, "would" : 3, "over" : 10, "so" : 10 }, "karma" : 117 }
{ "_id" : "jlangdon@example.ru", "first_name" : "Jean-Bernard", "last_name" : "Langdon", "registration_date" : ISODate("2020-10-22T00:00:00Z"), "birth_date" : ISODate("1973-04-21T00:00:00Z"), "visits" : 775, "top_tags" : { "feel" : 8, "once" : 6 }, "karma" : 171 }
{ "_id" : "acaty@example.ru", "first_name" : "Alisa", "last_name" : "Caty", "registration_date" : ISODate("2020-04-20T00:00:00Z"), "birth_date" : ISODate("1962-09-05T00:00:00Z"), "visits" : 498, "top_tags" : { "having" : 9, "by" : 3, "natural" : 3 }, "karma" : 67 }
{ "_id" : "mayana@example.net", "first_name" : "Mika", "last_name" : "Ayana", "registration_date" : ISODate("2021-04-13T00:00:00Z"), "birth_date" : ISODate("1990-04-05T00:00:00Z"), "visits" : 786, "top_tags" : { "when" : 7, "pictures" : 8, "daisy" : 6, "nothing" : 1, "rabbit" : 4 }, "karma" : 90 }
{ "_id" : "bfouad@example.com", "first_name" : "Building", "last_name" : "Fouad", "registration_date" : ISODate("2020-10-26T00:00:00Z"), "birth_date" : ISODate("1962-02-11T00:00:00Z"), "visits" : 977, "top_tags" : { "the" : 7, "down" : 1, "or" : 6, "nor" : 4, "rabbit" : 3, "of" : 7, "i" : 7 }, "karma" : -88 }
{ "_id" : "pkarlene@example.ru", "first_name" : "Pip", "last_name" : "Karlene", "registration_date" : ISODate("2021-04-03T00:00:00Z"), "birth_date" : ISODate("1913-08-12T00:00:00Z"), "visits" : 307, "top_tags" : { "rabbit" : 4, "natural" : 8, "in" : 5, "a" : 7 }, "karma" : 101 }
{ "_id" : "kyukinobu@example.com", "first_name" : "Kirstie", "last_name" : "Yukinobu", "registration_date" : ISODate("2020-04-17T00:00:00Z"), "birth_date" : ISODate("1992-08-18T00:00:00Z"), "visits" : 606, "top_tags" : { "had" : 1, "rabbit" : 1, "into" : 4 }, "karma" : 153 }
{ "_id" : "lprudy@example.ru", "first_name" : "Laverne", "last_name" : "Prudy", "registration_date" : ISODate("2021-11-07T00:00:00Z"), "birth_date" : ISODate("1900-07-22T00:00:00Z"), "visits" : 486, "top_tags" : { "use" : 4, "seemed" : 1, "by" : 4 }, "karma" : 159 }
{ "_id" : "mbelvia@example.ru", "first_name" : "Marlaine", "last_name" : "Belvia", "registration_date" : ISODate("2020-03-05T00:00:00Z"), "birth_date" : ISODate("1911-08-27T00:00:00Z"), "visits" : 464, "top_tags" : { "remarkable" : 6, "without" : 10 }, "karma" : 15 }
{ "_id" : "rdaphine@example.com", "first_name" : "Rebekkah", "last_name" : "Daphine", "registration_date" : ISODate("2021-02-18T00:00:00Z"), "birth_date" : ISODate("1911-01-21T00:00:00Z"), "visits" : 972, "top_tags" : { "very" : 9, "pictures" : 9, "by" : 9, "nothing" : 5, "beginning" : 8 }, "karma" : 119 }
{ "_id" : "jathene@example.ru", "first_name" : "Janey", "last_name" : "Athene", "registration_date" : ISODate("2020-04-17T00:00:00Z"), "birth_date" : ISODate("1932-01-10T00:00:00Z"), "visits" : 803, "top_tags" : { "stupid" : 1, "to" : 8, "tired" : 5 }, "karma" : -58 }
{ "_id" : "jcolleen@example.info", "first_name" : "Jovan", "last_name" : "Colleen", "registration_date" : ISODate("2020-02-25T00:00:00Z"), "birth_date" : ISODate("1919-05-15T00:00:00Z"), "visits" : 329, "top_tags" : { "watch" : 1, "remarkable" : 3, "rabbit" : 3, "at" : 5, "as" : 2, "a" : 4 }, "karma" : 106 }
{ "_id" : "memiliano@example.ru", "first_name" : "Manfred", "last_name" : "Emiliano", "registration_date" : ISODate("2020-09-02T00:00:00Z"), "birth_date" : ISODate("1958-12-13T00:00:00Z"), "visits" : 933, "top_tags" : { "it" : 6, "sitting" : 4 }, "karma" : 138 }
Type "it" for more


> db.users.aggregate([{$match: {"visits" : {$gt: 300}}}, {$project: {karma: "$karma"}}])
{ "_id" : "vjaniya@example.ru", "karma" : -43 }
{ "_id" : "lluc@example.info", "karma" : -33 }
{ "_id" : "byuko@example.com", "karma" : 126 }
{ "_id" : "mmickey@example.info", "karma" : 80 }
{ "_id" : "danni@example.com", "karma" : -25 }
{ "_id" : "pcierra@example.ru", "karma" : -7 }
{ "_id" : "gshena@example.net", "karma" : 160 }
{ "_id" : "ljoly@example.ru", "karma" : 117 }
{ "_id" : "jlangdon@example.ru", "karma" : 171 }
{ "_id" : "acaty@example.ru", "karma" : 67 }
{ "_id" : "mayana@example.net", "karma" : 90 }
{ "_id" : "bfouad@example.com", "karma" : -88 }
{ "_id" : "pkarlene@example.ru", "karma" : 101 }
{ "_id" : "kyukinobu@example.com", "karma" : 153 }
{ "_id" : "lprudy@example.ru", "karma" : 159 }
{ "_id" : "mbelvia@example.ru", "karma" : 15 }
{ "_id" : "rdaphine@example.com", "karma" : 119 }
{ "_id" : "jathene@example.ru", "karma" : -58 }
{ "_id" : "jcolleen@example.info", "karma" : 106 }
{ "_id" : "memiliano@example.ru", "karma" : 138 }
Type "it" for more


> db.users.aggregate([{$match: {"visits" : {$gt: 300}}}, {$project: {sum_karma: {$substr: ["$first_name",0,1]}}}])
{ "_id" : "vjaniya@example.ru", "sum_karma" : "V" }
{ "_id" : "lluc@example.info", "sum_karma" : "L" }
{ "_id" : "byuko@example.com", "sum_karma" : "B" }
{ "_id" : "mmickey@example.info", "sum_karma" : "M" }
{ "_id" : "danni@example.com", "sum_karma" : "D" }
{ "_id" : "pcierra@example.ru", "sum_karma" : "P" }
{ "_id" : "gshena@example.net", "sum_karma" : "G" }
{ "_id" : "ljoly@example.ru", "sum_karma" : "L" }
{ "_id" : "jlangdon@example.ru", "sum_karma" : "J" }
{ "_id" : "acaty@example.ru", "sum_karma" : "A" }
{ "_id" : "mayana@example.net", "sum_karma" : "M" }
{ "_id" : "bfouad@example.com", "sum_karma" : "B" }
{ "_id" : "pkarlene@example.ru", "sum_karma" : "P" }
{ "_id" : "kyukinobu@example.com", "sum_karma" : "K" }
{ "_id" : "lprudy@example.ru", "sum_karma" : "L" }
{ "_id" : "mbelvia@example.ru", "sum_karma" : "M" }
{ "_id" : "rdaphine@example.com", "sum_karma" : "R" }
{ "_id" : "jathene@example.ru", "sum_karma" : "J" }
{ "_id" : "jcolleen@example.info", "sum_karma" : "J" }
{ "_id" : "memiliano@example.ru", "sum_karma" : "M" }
Type "it" for more


